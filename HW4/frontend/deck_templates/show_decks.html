<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>All Decks</title>
    <style>
        body { font-family: system-ui, Arial, sans-serif; margin: 24px; background:#f7f9fc; color:#111; }
        h1 { margin-bottom: 12px; }
        .deck-list { display:flex; flex-direction:column; gap:10px; max-width:900px; }
        .deck { display:flex; align-items:center; justify-content:space-between; padding:12px 16px; background:#fff; border:1px solid #e0e6ef; border-radius:8px; box-shadow:0 1px 2px rgba(16,24,40,0.03); }
        .deck .left { display:flex; gap:12px; align-items:center; cursor:pointer; text-decoration:none; color:inherit; }
        .deck .title { font-weight:600; }
        .meta { color:#6b7280; font-size:0.9rem; }
        button.delete { background:#ef4444; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
        button.delete:hover { background:#dc2626; }
        .empty { color:#6b7280; padding:20px; text-align:center; }
    </style>
</head>
<body>
    <h1>Decks</h1>
    <div id="deck-list" class="deck-list" aria-live="polite">
        <!-- Decks will be rendered here -->
    </div>

    <script>
        let decks = []
        async function getDecks() {
            fetch('/decks', { method: 'GET', headers: { 'Accept': 'application/json' } })
                .then(response => response.json())
                .then(data => {
                    decks = data.decks || []
                    renderDecks()
                })
                .catch(error => {
                    console.error('Error fetching decks:', error)
                })
        }

        function renderDecks() {
            decks = document.getElementById('deck-list')
            deckList.innerHTML = ''
            if (decks.length === 0) {
                const emptyMessage = document.createElement('div')
                emptyMessage.className = 'empty'
                emptyMessage.textContent = 'No decks available.'
                deckList.appendChild(emptyMessage)
                return
            }
            decks.forEach(deck => {
                const deckDiv = document.createElement('div')
                deckDiv.className = 'deck'
                deckDiv.setAttribute('data-id', deck._id)
                const deckSize = deck.words ? deck.words.length : 0
                deckDiv.innerHTML = `
                    <div class="left" onclick="viewDeck('${deck._id}')">
                        <div class="title">${deck.name}</div>
                        <div class="meta">(${deckSize} cards) - ${deck.description}</div>
                    </div>
                    <button class="delete" onclick="deleteDeck(event, '${deck._id}')">Delete</button>
                `
                deckList.appendChild(deckDiv)
            })
        }
        function viewDeck(deckId) {
            window.location.href = `/show_deck/${deckId}`
        }
        function deleteDeck(event, deckId) {
            event.stopPropagation()
            if (!confirm('Are you sure you want to delete this deck?')) return
            fetch(`/deleteDeck/${deckId}`, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        decks = decks.filter(deck => deck._id !== deckId)
                        renderDecks()
                    } else {
                        console.error('Failed to delete deck')
                    }
                })
                .catch(error => {
                    console.error('Error deleting deck:', error)
                })
        }
        await getDecks()
        renderDecks()
    </script>
</body>
</html>